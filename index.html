<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laundry Slot Booking H-8</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0f4ff, #e1ecff);
      margin: 0; padding: 0;
    }
    .container {
      max-width: 700px; margin: 40px auto; background: #fff; padding: 30px;
      border-radius: 15px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    h2, h3 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
    label { display: block; margin-top: 20px; color: #2c3e50; font-weight: 600; }
    input, select, button {
      width: 100%; padding: 12px; margin-top: 8px;
      border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;
      font-family: 'Poppins', sans-serif;
    }
    button {
      background-color: #007BFF; color: white; font-weight: 600; border: none;
      margin-top: 30px;
    }
    button:hover { background-color: #0056b3; }
    #showBookingsBtn { background-color: #6c757d; margin-top: 20px; }
    #showBookingsBtn:hover { background-color: #495057; }
    .booking-entry {
      background: #f1f3f5; padding: 15px;
      border-left: 5px solid #007BFF;
      border-radius: 8px; margin-bottom: 12px;
      white-space: pre-line;
    }
    .current-slot {
      background-color: #e6ffe6;
      border-left: 5px solid green;
      position: relative;
    }
    .current-slot::after {
      content: "ðŸŸ¢ Live Now";
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 0.8rem;
      font-weight: bold;
      color: green;
    }
    #filterOptions { display: flex; gap: 15px; flex-wrap: wrap; }
  </style>
</head>

<body>
<div class="container">
  <h2>ðŸ§º Laundry Slot Booking H-8</h2>

  <form id="bookingForm">
    <label>Name</label>
    <input id="userName" required>

    <label>Select Date</label>
    <input type="date" id="bookingDate" required>

    <label>Big Washer</label>
    <select id="bigWasher"><option value="">-- Select Slot --</option></select>

    <label>Small Washer</label>
    <select id="smallWasher"><option value="">-- Select Slot --</option></select>

    <label>Big Dryer</label>
    <select id="bigDryer"><option value="">-- Select Slot --</option></select>

    <label>Small Dryer</label>
    <select id="smallDryer"><option value="">-- Select Slot --</option></select>

    <button type="submit">âœ… Book Slot</button>
  </form>

  <button id="showBookingsBtn">ðŸ“… Show Bookings</button>

  <div id="bookingSection" style="display:none">
    <h3>ðŸ“Œ Bookings</h3>
    <div id="filterOptions">
      <label><input type="checkbox" value="bigWasher"> Big Washer</label>
      <label><input type="checkbox" value="smallWasher"> Small Washer</label>
      <label><input type="checkbox" value="bigDryer"> Big Dryer</label>
      <label><input type="checkbox" value="smallDryer"> Small Dryer</label>
    </div>
    <div id="bookingList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getDatabase, ref, push, get, child } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfU-aqLYHF_X0Rwv0WqZtZB_M0cdacoDg",
  authDomain: "launry-booking-h8.firebaseapp.com",
  databaseURL: "https://launry-booking-h8-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "launry-booking-h8",
  storageBucket: "launry-booking-h8.firebasestorage.app",
  messagingSenderId: "485927717258",
  appId: "1:485927717258:web:be15abc9f8cd281846e073",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
signInAnonymously(auth);

const timeSlots = [];
for (let h = 0; h < 24; h++) {
  const start = `${String(h).padStart(2,'0')}:00`;
  const end = `${String((h+1)%24).padStart(2,'0')}:00`;
  timeSlots.push(`${start} - ${end}`);
}

const populateSlots = booked => {
  ["bigWasher","smallWasher","bigDryer","smallDryer"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML='<option value="">-- Select Slot --</option>';
    timeSlots.forEach(t=>{
      if(!booked[id]?.includes(t)){
        s.append(new Option(t,t));
      }
    });
  });
};

const loadBookings = async () => {
  const date = bookingDate.value;
  if (!date) return;

  const snap = await get(child(ref(db), `bookings/${date}`));
  const booked = {bigWasher:[],smallWasher:[],bigDryer:[],smallDryer:[]};
  bookingList.innerHTML="";

  if(snap.exists()){
    Object.values(snap.val()).forEach(e=>{
      bookingList.innerHTML +=
`${e.name} (${e.date})
Big Washer: ${e.bigWasher||"-"}
Small Washer: ${e.smallWasher||"-"}
Big Dryer: ${e.bigDryer||"-"}
Small Dryer: ${e.smallDryer||"-"}\n\n`;

      if(e.bigWasher) booked.bigWasher.push(e.bigWasher);
      if(e.smallWasher) booked.smallWasher.push(e.smallWasher);
      if(e.bigDryer) booked.bigDryer.push(e.bigDryer);
      if(e.smallDryer) booked.smallDryer.push(e.smallDryer);
    });
  }
  populateSlots(booked);
};

bookingForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const data={
    uid: auth.currentUser.uid,
    name:userName.value,
    date:bookingDate.value,
    bigWasher:bigWasher.value,
    smallWasher:smallWasher.value,
    bigDryer:bigDryer.value,
    smallDryer:smallDryer.value
  };

  const snap = await get(child(ref(db), `bookings/${data.date}`));
  if(snap.exists()){
    for(const e of Object.values(snap.val())){
      if(
        (data.bigWasher && e.bigWasher===data.bigWasher) ||
        (data.smallWasher && e.smallWasher===data.smallWasher) ||
        (data.bigDryer && e.bigDryer===data.bigDryer) ||
        (data.smallDryer && e.smallDryer===data.smallDryer)
      ){
        alert("âš ï¸ Slot already booked");
        return;
      }
    }
  }

  await push(ref(db, `bookings/${data.date}`), data);
  alert("âœ… Booking Successful");
  bookingForm.reset();
  loadBookings();
});

showBookingsBtn.onclick=()=>{
  bookingSection.style.display="block";
  loadBookings();
};

bookingDate.onchange = loadBookings;
</script>
</body>
</html>
