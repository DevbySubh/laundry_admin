<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Laundry Slot Booking H-8</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#f0f4ff,#e1ecff);
  margin:0
}
.page{
  display:flex;
  gap:20px;
  max-width:1300px;
  margin:auto;
  padding:20px
}
.container,.side{
  background:#fff;
  padding:30px;
  border-radius:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.1)
}
.container{flex:1}
.side{width:320px;position:sticky;top:20px;height:fit-content}
.hidden{display:none}

label{font-weight:600;margin-top:15px;display:block}
input,select,button{
  width:100%;padding:10px;margin-top:6px;
  border-radius:8px;border:1px solid #ccc
}
button{
  background:#007BFF;color:#fff;font-weight:600;
  border:none;cursor:pointer;margin-top:20px
}
.admin-btn{background:#6c757d}

.metric{background:#f8f9fa;padding:12px;border-radius:10px;margin-bottom:12px}
ol{padding-left:20px;margin:0;font-size:.9rem}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.4);
  display:flex;align-items:center;justify-content:center;z-index:1000
}
.modal-box{
  background:#fff;padding:25px;border-radius:12px;width:320px;text-align:center
}

.toast{
  position:fixed;bottom:20px;left:50%;
  transform:translateX(-50%);
  background:#212529;color:#fff;padding:12px 18px;
  border-radius:10px;font-size:.95rem;
  box-shadow:0 8px 20px rgba(0,0,0,.3);
  z-index:999;transition:.3s
}
.toast.hidden{opacity:0;pointer-events:none}
</style>
</head>

<body>

<!-- USER PAGE -->
<div class="page" id="userPage">

  <div class="container">
    <h2>ğŸ§º Laundry Slot Booking H-8</h2>

    <form id="bookingForm">
      <label>Name</label>
      <input id="userName" required>

      <label>Date</label>
      <input type="date" id="bookingDate" required>

      <label>Big Washer</label><select id="bigWasher"></select>
      <label>Small Washer</label><select id="smallWasher"></select>
      <label>Big Dryer</label><select id="bigDryer"></select>
      <label>Small Dryer</label><select id="smallDryer"></select>

      <button type="submit">âœ… Book Slot</button>
    </form>

    <button class="admin-btn" id="adminLoginBtn">ğŸ” Admin Login</button>
  </div>

  <div class="side">
    <h3>ğŸ† Laundry Legends</h3>

    <div class="metric" id="topMonth">ğŸ… Top Booker (This Month): â€”</div>
    <div class="metric" id="topAllTime">ğŸŒŸ All-Time Legend: â€”</div>

    <h4>ğŸ“… Top 10 â€“ This Month</h4>
    <ol id="top10Month"></ol>

    <h4>ğŸŒŸ Top 10 â€“ All Time</h4>
    <ol id="top10All"></ol>
  </div>

</div>

<!-- ADMIN PAGE -->
<div class="container hidden" id="adminPage">
  <h2>ğŸ› ï¸ Admin Dashboard</h2>
  <p>Admin successfully logged in.</p>
  <button class="admin-btn" onclick="logoutAdmin()">â¬… Back to User</button>
</div>

<!-- LOGIN MODAL -->
<div class="modal hidden" id="passwordModal">
  <div class="modal-box">
    <h3>Admin Login</h3>
    <input type="password" id="adminPassword" placeholder="Enter admin password">
    <button id="confirmAdminLogin">Login</button>
  </div>
</div>

<div id="toast" class="toast hidden"></div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import{getDatabase,ref,push,get}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyBfU-aqLYHF_X0Rwv0WqZtB_M0cdacoDg",
  authDomain:"launry-booking-h8.firebaseapp.com",
  databaseURL:"https://launry-booking-h8-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"launry-booking-h8",
  storageBucket:"launry-booking-h8.appspot.com",
  messagingSenderId:"485927717258",
  appId:"1:485927717258:web:be15abc9f8cd281846e073"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const fields=["bigWasher","smallWasher","bigDryer","smallDryer"];
const today=new Date().toLocaleDateString("en-CA");
const month=today.slice(0,7);
bookingDate.value=today;

const timeSlots=[...Array(24)].map((_,i)=>{
  const s=String(i).padStart(2,"0")+":00";
  const e=String((i+1)%24).padStart(2,"0")+":00";
  return `${s} - ${e}`;
});
fields.forEach(f=>{
  const s=document.getElementById(f);
  s.innerHTML='<option value="">-- Select Slot --</option>';
  timeSlots.forEach(t=>{
    const o=document.createElement("option");
    o.value=o.textContent=t;
    s.appendChild(o);
  });
});

/* BOOKING */
bookingForm.onsubmit=async e=>{
  e.preventDefault();
  await push(ref(db,`bookings/${bookingDate.value}`),{
    name:userName.value.trim(),
    date:bookingDate.value,
    bigWasher:bigWasher.value,
    smallWasher:smallWasher.value,
    bigDryer:bigDryer.value,
    smallDryer:smallDryer.value
  });
  alert("âœ… Booking Successful");
  bookingForm.reset();
};

/* ADMIN */
adminLoginBtn.onclick=()=>passwordModal.classList.remove("hidden");
confirmAdminLogin.onclick=()=>{
  if(adminPassword.value==="admin123"){
    passwordModal.classList.add("hidden");
    userPage.classList.add("hidden");
    adminPage.classList.remove("hidden");
    adminPassword.value="";
  }else alert("âŒ Wrong password");
};
window.logoutAdmin=()=>{
  adminPage.classList.add("hidden");
  userPage.classList.remove("hidden");
};

/* METRICS */
async function loadMetrics(){
  const snap=await get(ref(db,"bookings"));
  if(!snap.exists())return;

  const monthly={},allTime={},night={},early={};

  Object.values(snap.val()).forEach(day=>{
    Object.values(day).forEach(b=>{
      allTime[b.name]=(allTime[b.name]||0)+1;
      if(b.date.startsWith(month))
        monthly[b.name]=(monthly[b.name]||0)+1;

      fields.forEach(f=>{
        if(!b[f]||!b.date.startsWith(month))return;
        const h=parseInt(b[f]);
        if(h<5)night[b.name]=(night[b.name]||0)+1;
        if(h>=5&&h<7)early[b.name]=(early[b.name]||0)+1;
      });
    });
  });

  const sort=o=>Object.entries(o).sort((a,b)=>b[1]-a[1]);
  const m=sort(monthly),a=sort(allTime);

  if(m[0])topMonth.textContent=`ğŸ… Top Booker (This Month): ${m[0][0]} (${m[0][1]})`;
  if(a[0])topAllTime.textContent=`ğŸŒŸ All-Time Legend: ${a[0][0]} (${a[0][1]})`;

  top10Month.innerHTML=m.slice(0,10).map(x=>`<li>${x[0]} â€“ ${x[1]}</li>`).join("");
  top10All.innerHTML=a.slice(0,10).map(x=>`<li>${x[0]} â€“ ${x[1]}</li>`).join("");

  const insights=[];
  if(sort(night)[0])
    insights.push(`ğŸ¦‰ Night Owl: ${sort(night)[0][0]} (${sort(night)[0][1]} bookings)`);
  if(sort(early)[0])
    insights.push(`ğŸ“ Early Bird: ${sort(early)[0][0]} (${sort(early)[0][1]} bookings)`);

  rotate(insights);
}

let i=0;
function rotate(arr){
  if(!arr.length)return;
  setInterval(()=>{
    toast.textContent=arr[i%arr.length];
    toast.classList.remove("hidden");
    setTimeout(()=>toast.classList.add("hidden"),3500);
    i++;
  },5000);
}

loadMetrics();
</script>

</body>
</html>
